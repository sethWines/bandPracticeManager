<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Database Recovery Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .status-card h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-weight: 600;
            color: #555;
        }

        .status-value {
            color: #667eea;
            font-weight: bold;
        }

        .song-list {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }

        .song-item {
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .song-item:last-child {
            border-bottom: none;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Song Database Recovery Tool</h1>
        <p class="subtitle">Check localStorage and recover your missing songs</p>

        <div id="alertContainer"></div>

        <div class="status-card">
            <h2>üìä Database Status</h2>
            <div class="status-item">
                <span class="status-label">Songs in Database:</span>
                <span class="status-value" id="songCount">Checking...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Songs in Trash:</span>
                <span class="status-value" id="trashCount">Checking...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Undo History:</span>
                <span class="status-value" id="undoCount">Checking...</span>
            </div>
        </div>

        <div class="status-card" id="songListCard" style="display: none;">
            <h2>üìù Songs Found in Database</h2>
            <div class="song-list" id="songList"></div>
        </div>

        <div class="status-card" id="trashListCard" style="display: none;">
            <h2>üóëÔ∏è Songs Found in Trash</h2>
            <div class="song-list" id="trashList"></div>
        </div>

        <div style="margin-top: 30px;">
            <button class="btn btn-success" onclick="recoverAll()" id="recoverBtn">
                üîÑ Recover All Songs from Trash
            </button>
            <button class="btn btn-primary" onclick="exportBackup()">
                üíæ Export Database as CSV Backup
            </button>
            <button class="btn btn-primary" onclick="window.location.href='song-manager.html'">
                ‚Üê Back to Song Manager
            </button>
        </div>
    </div>

    <script>
        let songs = [];
        let trash = [];
        let undoHistory = [];

        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            document.getElementById('alertContainer').appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 5000);
        }

        function checkDatabase() {
            // Check songs
            const songsData = localStorage.getItem('songDatabase');
            const trashData = localStorage.getItem('songTrash') || localStorage.getItem('bandSongsTrash');
            
            songs = songsData ? JSON.parse(songsData) : [];
            trash = trashData ? JSON.parse(trashData) : [];

            document.getElementById('songCount').textContent = songs.length;
            document.getElementById('trashCount').textContent = trash.length;

            // Show song list if any
            if (songs.length > 0) {
                document.getElementById('songListCard').style.display = 'block';
                const songListHTML = songs.map((s, i) => 
                    `<div class="song-item">${i + 1}. ${s.song || 'Untitled'} by ${s.artist || 'Unknown'}</div>`
                ).join('');
                document.getElementById('songList').innerHTML = songListHTML;
            }

            // Show trash list if any
            if (trash.length > 0) {
                document.getElementById('trashListCard').style.display = 'block';
                const trashListHTML = trash.map((item, i) => {
                    const s = item.song || item;
                    return `<div class="song-item">${i + 1}. ${s.song || 'Untitled'} by ${s.artist || 'Unknown'}</div>`;
                }).join('');
                document.getElementById('trashList').innerHTML = trashListHTML;
                document.getElementById('recoverBtn').style.display = 'inline-block';
            } else {
                document.getElementById('recoverBtn').style.display = 'none';
            }

            // Analyze situation
            if (songs.length === 0 && trash.length === 0) {
                showAlert('‚ö†Ô∏è No songs found in database or trash. Database may be empty.', 'danger');
            } else if (songs.length === 0 && trash.length > 0) {
                showAlert(`‚ö†Ô∏è Found ${trash.length} songs in trash but database is empty. Click "Recover All" to restore them!`, 'warning');
            } else if (songs.length > 0 && trash.length > 0) {
                showAlert(`‚úÖ Found ${songs.length} songs in database and ${trash.length} in trash.`, 'success');
            } else {
                showAlert(`‚úÖ Found ${songs.length} songs in database.`, 'success');
            }
        }

        function recoverAll() {
            if (trash.length === 0) {
                showAlert('No songs in trash to recover.', 'warning');
                return;
            }

            if (!confirm(`Recover ${trash.length} song(s) from trash?`)) {
                return;
            }

            // Add all trash items back to songs
            trash.forEach(item => {
                const song = item.song || item;
                songs.push(song);
            });

            // Clear trash
            trash = [];

            // Save to localStorage
            localStorage.setItem('songDatabase', JSON.stringify(songs));
            localStorage.setItem('songTrash', JSON.stringify(trash));
            localStorage.setItem('bandSongsTrash', JSON.stringify(trash));

            showAlert(`‚úÖ Successfully recovered ${trash.length} songs! Reloading...`, 'success');
            
            setTimeout(() => {
                location.reload();
            }, 2000);
        }

        function exportBackup() {
            if (songs.length === 0) {
                showAlert('No songs to export.', 'warning');
                return;
            }

            // Create CSV
            const headers = ['Song', 'Artist', 'Album', 'Duration', 'Tuning', 'Key', 'First Note', 'Last Note', 'Bands', 'Tags', 'Practice Status', 'Play Count'];
            const csvContent = [
                headers.join(','),
                ...songs.map(song => [
                    `"${(song.song || '').replace(/"/g, '""')}"`,
                    `"${(song.artist || '').replace(/"/g, '""')}"`,
                    `"${(song.album || '').replace(/"/g, '""')}"`,
                    `"${(song.duration || '').replace(/"/g, '""')}"`,
                    `"${(song.tuning || '').replace(/"/g, '""')}"`,
                    `"${(song.key || '').replace(/"/g, '""')}"`,
                    `"${(song.firstNote || '').replace(/"/g, '""')}"`,
                    `"${(song.lastNote || '').replace(/"/g, '""')}"`,
                    `"${(song.bands || '').replace(/"/g, '""')}"`,
                    `"${(song.tags || '').replace(/"/g, '""')}"`,
                    `"${(song.practiceStatus || '').replace(/"/g, '""')}"`,
                    `"${(song.playCount || 0)}"`
                ].join(','))
            ].join('\n');

            // Download
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `band-songs-recovery-${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);

            showAlert(`‚úÖ Exported ${songs.length} songs to CSV!`, 'success');
        }

        // Run check on load
        window.onload = checkDatabase;
    </script>
</body>
</html>

